---
title: "Do Trump Reminders Cause Cognitive Dissonance?"
subtitle: "Experiments and Causality"
author: "Colby Carter, Abhishek Agarwal, Tiffany Jaya"
date: \today
output: 
  pdf_document: default
  word_document: default
---

# Introduction 

In the uncharted world of the Donald Trump presidency, there is an abundance of division,
misinformation, confirmation bias, and at times cognitive dissonance. While there is nothing new about partisan politics and presidential approval dividing along political lines, we suspect that Trump elicits a distinctive emotional response from many that transcends this typical political divide. For example, as mainstream media sources have been clear in their opposition--such as the Washington Post’s post-inauguration slogan[1], “Democracy Dies in Darkness”--many conservative media and political pundits have reacted to the rise of Trump similarly, with National Review publishing an issue[2] titled “Against Trump,” prior to election day. We wonder whether this strong emotional response is prevalent and felt outside of the media and political punditry and seek to test whether even a subtle reminder of Trump can cause a moment of cognitive dissonance (i.e. inconsistent beliefs triggered by emotion). Or, alternatively, do we observe that typical Americans are consistent in their levels of optimism about the most important aspects of their lives, irrespective of who is president?

# Research Question

In this experiment, we seek to survey respondents who are representative of the American public to answer the following question:

_Does a subtle reminder of Donald Trump cause an immediate change in the level of optimism toward key aspects of life, such as employment or retirement prospects?_

We consider it important given the appearance of the current political climate. It is our hope that there is no strong effect across subjects, though we hypothesize that there could be heterogeneous effects for smaller segments of the population, including subsets of the political parties.

A related survey was conducted recently to determine the level of optimism American workers have in employment outlook a year after President Trump's election[3]. It found that men were estimated twice as likely as women to be more optimistic, while there were also subtle differences by race, education and geography. In our study, we control for these factors while considering the possibility of heterogeneous treatment effects. 

# Hypothesis 

Given the strong emotional response that Trump elicits from people across the political spectrum, we hypothesize that even a subtle mention of his name can momentarily affect the immediate level of optimism some Americans have on priorities that should be considered important and neutral across political lines, like employment, education, retirement, and cybersecurity. Whether the effect will be more positive or more negative, we assume it will be similar to the dividing attitudes in the news media. Conservatives will be more optimistic than liberals when it comes down to the association of Trump's name, but like the media in general, we expect the optimism will largely go downhill with the treatment of Trump applied to any topic. 

# Experiment 

```{r, include=FALSE}
# load the library
library(data.table) 
library(dplyr)
library(knitr)
library(geonames)
library(ggplot2)
library(grid)
library(gridExtra)
library(gtable)
library(lmtest) 
library(lubridate)
library(png)
library(reshape2)
library(sandwich) 
library(RJSONIO)
library(stargazer)
```

```{r, include=FALSE}
# helper function 
convert_fctr_to_boolean <- function(col) {
  return(as.numeric(as.logical(col)))
}
convert_fctr_to_datetime <- function(col) {
  return(as.POSIXct(col, format="%Y-%m-%d %H:%M:%S"))
}
convert_fctr_to_numeric <- function(col) {
  return(as.numeric(levels(col)[col]))
}
convert_fctr_to_str <- function(col) {
  return(as.character(col))
}
format_table <- function(list, title) {
  table <- tableGrob(list)
  title <- textGrob(title, gp=gpar(fontsize=11))
  table <- gtable_add_rows(
    table, 
    heights = grobHeight(title) + unit(5,"mm"),
    pos = 0)
  table <- gtable_add_grob(
    table, 
    title, 
    1, 1, 1, ncol(table))
  return(table)
}
```

```{r, include=FALSE}
# load the dataset
d <- read.csv(file = "data/W241 Colby Carter, Tiffany Jaya, Abhishek Agarwal_April 22, 2018_15.32.csv",
              header = TRUE, 
              sep = ",")

# remove the first two rows
d <- tail(d, -2)

# rename columns to be more descriptive
setnames(d, 
         old = c("Q1.1", 
                 "Q2.2_1",
                 "Q2.3_1",
                 "Q2.5_1",
                 "Q2.7_1",
                 "Q3.1_1", 
                 "Q3.3_1",
                 "Q3.5_1",
                 "Q3.7_1",
                 "Q4.1",
                 "Q4.2",
                 "Q4.3",
                 "Q4.4",
                 "Q4.5",
                 "Q4.6",
                 "Q4.7",
                 "Q4.8",
                 "Q4.9",
                 "Q4.10",
                 "Q4.11",
                 "Q4.12",
                 "Q4.13",
                 "Q4.14",
                 "Q4.15",
                 "Q4.16", 
                 "Q2.1_First.Click",
                 "Q2.1_Last.Click",
                 "Q2.1_Page.Submit",
                 "Q2.1_Click.Count",
                 "Q2.4_First.Click",
                 "Q2.4_Last.Click",
                 "Q2.4_Page.Submit",
                 "Q2.4_Click.Count",
                 "Q2.6_First.Click",
                 "Q2.6_Last.Click",
                 "Q2.6_Page.Submit",
                 "Q2.6_Click.Count",
                 "Q2.8_First.Click",
                 "Q2.8_Last.Click",
                 "Q2.8_Page.Submit",
                 "Q2.8_Click.Count",
                 "Q3.2_First.Click",
                 "Q3.2_Last.Click",
                 "Q3.2_Page.Submit",
                 "Q3.2_Click.Count",
                 "Q3.4_First.Click",
                 "Q3.4_Last.Click",
                 "Q3.4_Page.Submit",
                 "Q3.4_Click.Count",
                 "Q3.6_First.Click",
                 "Q3.6_Last.Click",
                 "Q3.6_Page.Submit",
                 "Q3.6_Click.Count",
                 "Q3.8_First.Click",
                 "Q3.8_Last.Click",
                 "Q3.8_Page.Submit",
                 "Q3.8_Click.Count"),
         new = c("consent", 
                 "control_employment",
                 "control_education", # baseline
                 "control_retirement",
                 "control_cybersecurity",
                 "treatment_employment",
                 "treatment_education", # baseline,
                 "treatment_retirement",
                 "treatment_cybersecurity",
                 "gender",
                 "age",
                 "highest_education",
                 "employment_status",
                 "marital_status",
                 "zip_code",
                 "community", # rural, urban, suburban
                 "can_vote",
                 "political_party",
                 "ethnicity",
                 "income",
                 "have_kids",
                 "internet_from_mobile",
                 "internet_from_home",
                 "internet_from_work",
                 "who_pays_internet",
                 "control_employment_First.Click",
                 "control_employment_Last.Click",
                 "control_employment_Page.Submit",
                 "control_employment_Click.Count",
                 "control_education_First.Click",
                 "control_education_Last.Click",
                 "control_education_Page.Submit",
                 "control_education_Click.Count",
                 "control_retirement_First.Click",
                 "control_retirement_Last.Click",
                 "control_retirement_Page.Submit",
                 "control_retirement_Click.Count",
                 "control_cybersecurity_First.Click",
                 "control_cybersecurity_Last.Click",
                 "control_cybersecurity_Page.Submit",
                 "control_cybersecurity_Click.Count",
                 "treatment_employment_First.Click",
                 "treatment_employment_Last.Click",
                 "treatment_employment_Page.Submit",
                 "treatment_employment_Click.Count",
                 "treatment_education_First.Click",
                 "treatment_education_Last.Click",
                 "treatment_education_Page.Submit",
                 "treatment_education_Click.Count",
                 "treatment_retirement_First.Click",
                 "treatment_retirement_Last.Click",
                 "treatment_retirement_Page.Submit",
                 "treatment_retirement_Click.Count",
                 "treatment_cybersecurity_First.Click",
                 "treatment_cybersecurity_Last.Click",
                 "treatment_cybersecurity_Page.Submit",
                 "treatment_cybersecurity_Click.Count"))

# remove rownames to avoid confusion (because it is not the subject's id)
rownames(d) <- NULL

# safely convert columns of type factors to their respective types
# 1.factor -> datetime
cols <- c("StartDate", "EndDate", "RecordedDate")
d[,cols] <- lapply(d[,cols], convert_fctr_to_datetime)
# 2. factor -> logical/boolean
cols <- c("Finished")
d[,cols] <- lapply(d[,cols], convert_fctr_to_boolean)
d$consent <- ifelse(d$consent == "Yes", 1, 0)
d$can_vote <- ifelse(d$can_vote == "Yes", 1, 0)
d$have_kids <- ifelse(d$have_kids == "Yes", 1, 0)
# 3. factor -> numeric
cols <- c("Progress", 
          "Duration..in.seconds.", 
          "LocationLatitude", 
          "LocationLongitude",
          "control_employment", 
          "control_education", 
          "control_retirement", 
          "control_cybersecurity",
          "treatment_employment", 
          "treatment_education", 
          "treatment_retirement", 
          "treatment_cybersecurity",
          "zip_code",
          "control_employment_First.Click", 
          "control_employment_Last.Click", 
          "control_employment_Page.Submit", 
          "control_employment_Click.Count", 
          "control_education_First.Click",
          "control_education_Last.Click",
          "control_education_Page.Submit",
          "control_education_Click.Count",
          "control_retirement_First.Click",
          "control_retirement_Last.Click",
          "control_retirement_Page.Submit",
          "control_retirement_Click.Count",
          "control_cybersecurity_First.Click",
          "control_cybersecurity_Last.Click",
          "control_cybersecurity_Page.Submit",
          "control_cybersecurity_Click.Count",
          "treatment_employment_First.Click",
          "treatment_employment_Last.Click",
          "treatment_employment_Page.Submit",
          "treatment_employment_Click.Count",
          "treatment_education_First.Click",
          "treatment_education_Last.Click",
          "treatment_education_Page.Submit",
          "treatment_education_Click.Count",
          "treatment_retirement_First.Click",
          "treatment_retirement_Last.Click",
          "treatment_retirement_Page.Submit",
          "treatment_retirement_Click.Count",
          "treatment_cybersecurity_First.Click",
          "treatment_cybersecurity_Last.Click",
          "treatment_cybersecurity_Page.Submit",
          "treatment_cybersecurity_Click.Count"
          )
d[,cols] <- lapply(d[,cols], convert_fctr_to_numeric)
# 4. factor -> str
cols <- c("IPAddress", "ResponseId", "UserLanguage", "highest_education")
d[,cols] <- lapply(d[,cols], convert_fctr_to_str)

# get country information based on latlong
options(geonamesUsername="sullivannicole") # login
country_names <- mapply(
  function(lat, long) {
    suppressWarnings(try(GNcountryCode(lat, long)$countryName, silent = TRUE))
  }, d$LocationLatitude, d$LocationLongitude)
d$country <- country_names

# save a copy of the original dataset
data <- d

# filter for subjects who finish the survey 100%
d <- d %>% filter(., Progress == 100)

# filter for subjects who consented to take the survey
d <- d[which(d$consent == 1),]

# filter for subjects who are from USA
d <- d %>% filter(., country == "United States")

# filter out subjects who took the survey more than once
subjects.repeater <- d %>% group_by(IPAddress) %>% summarize(freq = sum(n())) %>% filter(freq > 1)
d <- d %>% filter(!(IPAddress %in% subjects.repeater$IPAddress))

# indicate which subjects are in treatment and which are in control
# since all subjects complete the survey by this point, this is a valid way to tag the subjects
d$treatment_ind <- ifelse(is.na(d$control_cybersecurity_Page.Submit), 1, 0)
```

## Research Design

Our experiment draws upon two sets of nearly identical surveys randomly assigned to one of two groups, our treatment and control. Both surveys contain four prompts on the subjects of employment, education, retirement and cybersecurity, followed by the questions:

1. How do you feel about the general employment outlook for Americans over the next two decades?
2. How do you feel about how the education system is preparing students to enter the workforce?
3. How do you feel about your prospects for saving enough for retirement?
4. How would you rate the threat of cyber-attacks to your security, private information or livelihood?

For those respondents who are assigned to treatment, they see all prompts with the same type of treatment, which we will call the “Trump treatment” hereafter; subjects assigned to control see no mentions of Trump, instead with a simple reference to the same period, such as “in 2018.” An example prompt follows, with the treatment emphasized:

_Now approaching a decade since the worst of the 2008 financial crisis, a steady recovery in the United States has brought a return of modest, sustained economic growth averaging roughly 2% annually, along with rising wage growth of over 3%. While rapid technological advancement has brought new efficiency and growth opportunities to many segments of the economy, many geographic areas and industries also face difficulties competing in global markets and continuing to provide economic opportunities. Overall, however, the unemployment rate has reached a decade-low of close to 4% **one year into the Donald Trump presidency**, a level lower than pre-crisis unemployment and considered by some economists to be full employment._

Education is the only prompt that does not contain any Trump treatment in either subject group, which serves two purposes. It serves as a baseline to verify that the level of optimism in both treatment and control are approximately equal. It also poses as a diversion to the exact purpose of the survey. With each prompt, the respondent is given a minimum of 40 seconds to read the text and then answer the question, which is a sliding scale from 0 to 100; we use this wide scale in order to achieve some variance in the distribution of responses. The flow of the survey as well as an example of the scale are shown in Figure 1 and Figure 2-3 respectively. 

```{r echo=FALSE, fig1, out.width="90%", fig.align="center", fig.cap="Survey Flow"}
img_path.survey_flow <- "images/survey_flow.png"
include_graphics(img_path.survey_flow)
```
```{r echo=FALSE, fig2, out.width="80%", fig.align="center", fig.cap="Scale used for employment, education, and retirement prompt"}
img_path.optimistic_scale <- "images/optimistic_scale.png"
include_graphics(img_path.optimistic_scale)
```



```{r echo=FALSE, fig3, out.width="80%", fig.align="center", fig.cap="Scale used for cybersecurity prompt"}
img_path.threat_scale <- "images/threat_scale.png"
include_graphics(img_path.threat_scale)
```

## Randomization Engineering

To collect a broad sample of the American population, we turned to Mechanical Turk to select our subjects. We used Qualtrics to assign subjects equally to their respective control and treatment groups as shown in Figure 4. 

```{r echo=FALSE, fig4, out.width="60%", fig.align="center", fig.cap="Random Assignment"}
img_path.random_assignment <- "images/random_assignment.png"
include_graphics(img_path.random_assignment)
```

Unfortunately, even though we have requested Mechanical Turk to select subjects only in the United States, we still receive users whose country of origin is not from the United States. Out of 688 subjects, 580 reside in the United States and 108 reside outside of the United States. 

```{r echo=FALSE}
m <- matrix(c(data %>% filter(., country == "United States") %>% count(.), 
              data %>% filter(., country != "United States") %>% count(.)
              ), 
            ncol=2, byrow=TRUE)
colnames(m) <- c("US", "Non-US")
knitr::kable(m)
```

In addition, we filtered out subjects who did not complete the survey (including those who did not provide their consent) as well as subjects who took the survey more than once, which left us with 557 subjects: 262 in control and 295 in treatment.   

```{r echo=FALSE}
m <- matrix(c(d %>% filter(., treatment_ind == 0) %>% count(.), 
              d %>% filter(., treatment_ind == 1) %>% count(.),
              d %>% count(.)
              ), 
            ncol=3, byrow=TRUE)
colnames(m) <- c("Control", "Treatment", "Total")
knitr::kable(m)
```

All devices connected to the same router will share the same external IP address. The reason why we removed repeated test-takers with the same IP address is because we have no way to confirm whether or not the test-takers are roommates, people who are visiting, or the same individual. The data themselves are conflicting with some answers completely the same while others completely different in terms of the covariates. To be safe, we removed these repeated test-takers from our analysis.

## Measurement of variables: covariates


We should have detailed information about what exact covariate imbalances exist


In Figure 2 we get a sense of the joint distributions of
three key variables: age, gender, and race. 

young individuals
weighted most heavily by CCES are often the same categories
that MTurk was best at attracting.










```{r, echo=FALSE}
control.gender.percentage <- d %>% 
  filter(., treatment_ind == 0 & gender != "") %>%
  group_by(gender) %>%
  summarize(freq = sum(n())) %>%
  mutate(percentage = freq / sum(freq))
treatment.gender.percentage <- d %>%
  filter(., treatment_ind == 1 & gender != "") %>%
  group_by(gender) %>%
  summarize(freq = sum(n())) %>%
  mutate(percentage = freq / sum(freq))
grid.arrange(
  format_table(control.gender.percentage, "Control"),
  format_table(treatment.gender.percentage, "Treatment"),
  nrow=1
)
```

```{r echo=FALSE, fig5, fig.caption="Gender differences in control and treatment", out.width="80%", fig.align="center"}
ggplot(d %>% 
         filter(., gender != "") %>% 
         group_by(gender, treatment_ind) %>% 
         tally(), 
       aes(x = gender, y = n)) + 
geom_bar(stat = 'identity', position = 'stack', show.legend=FALSE) + 
facet_grid(~ treatment_ind, labeller = as_labeller(c(`0`="Control", `1`="Treatment"))) + 
aes(fill = as.factor(treatment_ind))
```


```{r, echo=FALSE}
prop.test(table(d$treatment_ind, d$gender) %>% .[,c("Female", "Male")], correct=FALSE)
```

```{r, echo=FALSE}
control.ethnicity.percentage <- d %>% 
  filter(., treatment_ind == 0 & ethnicity != "") %>%
  group_by(ethnicity) %>%
  summarize(freq = sum(n())) %>%
  mutate(percentage = freq / sum(freq))
treatment.ethnicity.percentage <- d %>%
  filter(., treatment_ind == 1 & ethnicity != "") %>%
  group_by(ethnicity) %>%
  summarize(freq = sum(n())) %>%
  mutate(percentage = freq / sum(freq))
grid.arrange(
  format_table(control.ethnicity.percentage, "Control"),
  format_table(treatment.ethnicity.percentage, "Treatment"),
  nrow=1
)
```

 75% of all respondents in CCES and MTurk
were White

```{r echo=FALSE, out.width="80%", fig.align="center"}
ggplot(d %>%
         filter(., gender != "") %>%
         group_by(age, ethnicity, gender) %>% 
         tally(), 
       aes(x = age, y = n, fill = ethnicity)) + 
  geom_bar(stat = 'identity', position = 'stack') + facet_grid(~ gender)
```



```{r echo=FALSE, out.width="49%", fig.align="center", fig.show="hold"}
library(maps)
library(ggplot2)
usa_map <- map_data("state")
gg <- ggplot(usa_map)
gg <- gg + geom_map(data = usa_map, 
                    map = usa_map, 
                    aes(map_id = region),
                    fill = "white",
                    color = "gray70")
geomap1 <- unique(d, by=c("LocationLatitude", "LocationLongitude"))
gg <- gg + geom_point(data = geomap1,
                      aes(LocationLongitude, LocationLatitude),
                      colour="red", 
                      alpha = 1/10,
                      size = 0.5)
print(gg)
```

```{r echo=FALSE, out.width="49%", fig.align="center", fig.show="hold"}
# political identity

# able to vote

# marital status
# have kids
# community
# highest education
# employment 
# income 
# internet
```

## Modeling choices

# Result

Clean, clear, well articulated relationships between your theory, your hypotheses, the numbers that your models produce, and the figures you present

* power analysis

* 

# References

1. "The Washington Post: 'Democracy dies in darkness' | TheHill." The Hill - covering Congress, Politics, Political Campaigns and Capitol Hill, 22 Feb. 2017, 
www.people-press.org/2017/10/05/the-partisan-divide-on-political-values-grows-even-wider.

2. "Donald Trump -- Conservative Movement Shouldn't Support Him | National Review." National Review: Conservative News, Opinion, Politics, Policy, & Current Events, 22 Jan. 2016, www.nationalreview.com/2016/01/donald-trump-conservative-movement-menace.

3. Borick, Christopher. “Capital - Are American Workers More Optimistic under Trump?” BBC, BBC, 8 Nov. 2017, www.bbc.com/capital/story/20171108-are-american-workers-more-optimistic-under-trump.