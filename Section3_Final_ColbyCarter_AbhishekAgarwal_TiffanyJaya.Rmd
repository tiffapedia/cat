---
title: "Do Trump Reminders Cause Cognitive Dissonance?"
subtitle: "Experiments and Causality"
author: "Colby Carter, Abhishek Agarwal, Tiffany Jaya"
date: \today
output: 
  pdf_document: default
  word_document: default
---

# Introduction

Media has often portrayed the American public as...
has found that voters’ pessimism about Trump’s presidency has outstripped optimism since last May

## Load the libraries

```{r, include=FALSE, results='hide'}
library(data.table) # fread
library(dplyr)
library(geonames)
library(lmtest) # coeftest
library(lubridate) # time conversion
library(sandwich) # vcovHC
library(RJSONIO)
library(stargazer)

library(knitr)
knitr::opts_chunk$set(echo = TRUE, fig.width=6, fig.height=4, 
                      tidy.opts=list(width.cutoff=60),tidy=TRUE)
```

## Helper functions

```{r}
convert_fctr_to_boolean <- function(col) {
  return(as.numeric(as.logical(col)))
}

convert_fctr_to_datetime <- function(col) {
  return(as.POSIXct(col, format="%Y-%m-%d %H:%M:%S"))
}

convert_fctr_to_numeric <- function(col) {
  return(as.numeric(levels(col)[col]))
}

convert_fctr_to_str <- function(col) {
  return(as.character(col))
}
```

## Load the dataset

```{r}
d <- read.csv(file = "./W241 Colby Carter, Tiffany Jaya, Abhishek Agarwal_April 12, 2018_09.41.csv",
              header = TRUE, 
              sep = ",")

# remove the first two rows
d <- tail(d, -2)

# rename columns to be more descriptive
setnames(d, 
         old = c("Q1.1", 
                 "Q2.2_1",
                 "Q2.3_1",
                 "Q2.5_1",
                 "Q2.7_1",
                 "Q3.1_1", 
                 "Q3.3_1",
                 "Q3.5_1",
                 "Q3.7_1",
                 "Q4.1",
                 "Q4.2",
                 "Q4.3",
                 "Q4.4",
                 "Q4.5",
                 "Q4.6",
                 "Q4.7",
                 "Q4.8",
                 "Q4.9",
                 "Q4.10",
                 "Q4.11",
                 "Q4.12",
                 "Q4.13",
                 "Q4.14",
                 "Q4.15",
                 "Q4.16", 
                 "Q2.1_First.Click",
                 "Q2.1_Last.Click",
                 "Q2.1_Page.Submit",
                 "Q2.1_Click.Count",
                 "Q2.4_First.Click",
                 "Q2.4_Last.Click",
                 "Q2.4_Page.Submit",
                 "Q2.4_Click.Count",
                 "Q2.6_First.Click",
                 "Q2.6_Last.Click",
                 "Q2.6_Page.Submit",
                 "Q2.6_Click.Count",
                 "Q2.8_First.Click",
                 "Q2.8_Last.Click",
                 "Q2.8_Page.Submit",
                 "Q2.8_Click.Count",
                 "Q3.2_First.Click",
                 "Q3.2_Last.Click",
                 "Q3.2_Page.Submit",
                 "Q3.2_Click.Count",
                 "Q3.4_First.Click",
                 "Q3.4_Last.Click",
                 "Q3.4_Page.Submit",
                 "Q3.4_Click.Count",
                 "Q3.6_First.Click",
                 "Q3.6_Last.Click",
                 "Q3.6_Page.Submit",
                 "Q3.6_Click.Count",
                 "Q3.8_First.Click",
                 "Q3.8_Last.Click",
                 "Q3.8_Page.Submit",
                 "Q3.8_Click.Count"),
         new = c("consent", 
                 "control_employment",
                 "control_education", # baseline
                 "control_retirement",
                 "control_cybersecurity",
                 "treatment_employment",
                 "treatment_education", # baseline,
                 "treatment_retirement",
                 "treatment_cybersecurity",
                 "gender",
                 "age",
                 "highest_education",
                 "employment_status",
                 "marital_status",
                 "zip_code",
                 "community", # rural, urban, suburban
                 "can_vote",
                 "political_party",
                 "ethnicity",
                 "income",
                 "have_kids",
                 "internet_from_mobile",
                 "internet_from_home",
                 "internet_from_work",
                 "who_pays_internet",
                 "control_employment_First.Click",
                 "control_employment_Last.Click",
                 "control_employment_Page.Submit",
                 "control_employment_Click.Count",
                 "control_education_First.Click",
                 "control_education_Last.Click",
                 "control_education_Page.Submit",
                 "control_education_Click.Count",
                 "control_retirement_First.Click",
                 "control_retirement_Last.Click",
                 "control_retirement_Page.Submit",
                 "control_retirement_Click.Count",
                 "control_cybersecurity_First.Click",
                 "control_cybersecurity_Last.Click",
                 "control_cybersecurity_Page.Submit",
                 "control_cybersecurity_Click.Count",
                 "treatment_employment_First.Click",
                 "treatment_employment_Last.Click",
                 "treatment_employment_Page.Submit",
                 "treatment_employment_Click.Count",
                 "treatment_education_First.Click",
                 "treatment_education_Last.Click",
                 "treatment_education_Page.Submit",
                 "treatment_education_Click.Count",
                 "treatment_retirement_First.Click",
                 "treatment_retirement_Last.Click",
                 "treatment_retirement_Page.Submit",
                 "treatment_retirement_Click.Count",
                 "treatment_cybersecurity_First.Click",
                 "treatment_cybersecurity_Last.Click",
                 "treatment_cybersecurity_Page.Submit",
                 "treatment_cybersecurity_Click.Count"))

# remove rownames to avoid confusion (because it is not the subject's id)
rownames(d) <- NULL

# safely convert columns of type factors to their respective types
# 1.factor -> datetime
cols <- c("StartDate", "EndDate", "RecordedDate")
d[,cols] <- lapply(d[,cols], convert_fctr_to_datetime)
# 2. factor -> logical/boolean
cols <- c("Finished")
d[,cols] <- lapply(d[,cols], convert_fctr_to_boolean)
d$consent <- ifelse(d$consent == "Yes", 1, 0)
d$can_vote <- ifelse(d$can_vote == "Yes", 1, 0)
d$have_kids <- ifelse(d$have_kids == "Yes", 1, 0)
# 3. factor -> numeric
cols <- c("Progress", 
          "Duration..in.seconds.", 
          "LocationLatitude", 
          "LocationLongitude",
          "control_employment", 
          "control_education", 
          "control_retirement", 
          "control_cybersecurity",
          "treatment_employment", 
          "treatment_education", 
          "treatment_retirement", 
          "treatment_cybersecurity",
          "zip_code",
          "control_employment_First.Click", 
          "control_employment_Last.Click", 
          "control_employment_Page.Submit", 
          "control_employment_Click.Count", 
          "control_education_First.Click",
          "control_education_Last.Click",
          "control_education_Page.Submit",
          "control_education_Click.Count",
          "control_retirement_First.Click",
          "control_retirement_Last.Click",
          "control_retirement_Page.Submit",
          "control_retirement_Click.Count",
          "control_cybersecurity_First.Click",
          "control_cybersecurity_Last.Click",
          "control_cybersecurity_Page.Submit",
          "control_cybersecurity_Click.Count",
          "treatment_employment_First.Click",
          "treatment_employment_Last.Click",
          "treatment_employment_Page.Submit",
          "treatment_employment_Click.Count",
          "treatment_education_First.Click",
          "treatment_education_Last.Click",
          "treatment_education_Page.Submit",
          "treatment_education_Click.Count",
          "treatment_retirement_First.Click",
          "treatment_retirement_Last.Click",
          "treatment_retirement_Page.Submit",
          "treatment_retirement_Click.Count",
          "treatment_cybersecurity_First.Click",
          "treatment_cybersecurity_Last.Click",
          "treatment_cybersecurity_Page.Submit",
          "treatment_cybersecurity_Click.Count"
          )
d[,cols] <- lapply(d[,cols], convert_fctr_to_numeric)
# 4. factor -> str
cols <- c("IPAddress", "ResponseId", "UserLanguage", "highest_education")
d[,cols] <- lapply(d[,cols], convert_fctr_to_str)
```

## Add additional information into the dataset

```{r, echo=FALSE}
# login information
options(geonamesUsername="sullivannicole")
```

```{r}
# get country information based on latlong
country_names <- mapply(
  function(lat, long) {
    suppressWarnings(try(GNcountryCode(lat, long)$countryName, silent = TRUE))
  }, d$LocationLatitude, d$LocationLongitude)
d$country <- country_names
```

## Analysis

data: contains the original dataset

```{r}
# save a copy of the original dataset
data <- d
```

### Filter

d: contains the dataset after we filtered out for the following:

1. subjects who did not finish the survey 100%
2. subjects who consented to take the survey

```{r}
# filter for subjects who consented to take the survey
d <- d[which(d$consent == 1),]
```

3. subjects who are from USA

```{r}
# filter for subjects who are from USA
d <- d %>% filter(., country == "United States")
```

4. subjects who took the survey once

```{r}
# filter out subjects who took the survey more than once
subjects.repeater <- d %>% group_by(IPAddress) %>% summarize(freq = sum(n())) %>% filter(freq > 1)
d <- d %>% filter(!(IPAddress %in% subjects.repeater$IPAddress))
```

### How many took the survey?

```{r}
# how many subjects take the survey?
nrow(data)
```

638 subjects take the survey.

### Verify that ResponseId is unique

```{r}
# is ResponseId unique? 
# if yes, use ResponseId as a unique id
freq_responseid <- data %>% group_by(ResponseId) %>% summarize(freq = sum(n()))
sum(freq_responseid$freq > 1) == 0
```

ResponseId is unique. 

### Verify that all the subjects completed the survey

```{r}
# how many subjects did not finish the survey?
sum(!data$Finished)
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the progress of each subject
hist(data$Progress, 
     xlab = "progress (%)",
     ylab = "number of users",
     breaks = -0.5:100.5, 
     ylim = c(0, 700),
     labels = TRUE)
```

All of the subjects completed the survey. 

### Verify that all subjects completed the survey in reasonable time (greater than 2 minutes)

```{r}
# how long does it take the subjects who consented to finish the survey in minutes?
subjects.consent <- data[which(data$consent == 1),]
summary(subjects.consent$Duration..in.seconds./60)
```

The following checks are unnecessary:

```{r}
# list all the subjects who take less than 2 minutes to finish the survey
subjects.less_2_min <- data[which(data$Duration..in.seconds./60 < 2),]
nrow(subjects.less_2_min)
```

```{r}
# list all subjects who did not consent
subjects.no_consent <- data[which(data$consent == 0),]
nrow(subjects.no_consent)
```

```{r}
# verify that the subjects who did not consent 
# match the subjects who took the survey in less than 2 minutes
all(subjects.less_2_min$ResponseId %in% subjects.no_consent$ResponseId)
```

### Verify that all subjects have English set as their language

```{r}
# list all languages not in English
data[which(data$UserLanguage != "EN"),]$UserLanguage
```

### Verify that all subjects are from United States

```{r}
# how many subjects are from United States?
data %>% filter(., country == "United States") %>% count(.)
# how many subjects are from outside the United States?
data %>% filter(., country != "United States") %>% count(.)
```

Out of 638 subjects, 580 subjects are from the United States and 58 are from outside the United States.

```{r}
data %>% group_by(country) %>% summarize(countries = unique(country), freq=sum(n()))
```

```{r}
library(maps)
library(ggplot2)
world_map <- map_data("world")
gg <- ggplot(world_map)
gg <- gg + geom_map(dat = world_map, 
                    map = world_map, 
                    aes(map_id = region),
                    fill = "white",
                    color = "gray70")
geomap1 <- unique(data, by=c("LocationLatitude", "LocationLongitude"))
gg <- gg + geom_point(data = geomap1,
                      aes(LocationLongitude, LocationLatitude),
                      colour="red", 
                      alpha = 1/10,
                      size = 0.5)
print(gg)
```



### Verify that subjects only took the survey once

```{r}
subjects.repeater
```

All devices connected to the same router will share the same external IP address.

```{r}
d %>% filter(IPAddress == "170.185.202.19")
```

It might be that the two women who took the survey are roommates, but since we have no way to confirm, it is better not to use this dataset in the study.

```{r}
d %>% filter(IPAddress == "24.46.117.154")
```

It's simply not possible that different people with different zip codes to have the same IP address. The reliability of this data is questionable. It might be possible that friends come over to take the same survey, but since we have no way to confirm, it is better not to use this dataset in the study.

```{r}
d %>% filter(IPAddress == "50.88.107.50")
```

With the same reasoning as above, it is better not to use this dataset.

```{r}
d %>% filter(IPAddress == "67.183.210.112")
```

With the same reasoning as above, it is better not to use this dataset.

### Verify that subjects answer all the questions

```{r}
# check if subjects in control answer all questions
d %>%
  select(control_employment, control_education, control_retirement, control_cybersecurity) %>%
  summarise_all(funs(sum(!is.na(.))))
```

Yes, subjects in control answer all the questions. There are 262 subjects in control.

```{r}
# check if subjects in treatment answer all questions
d %>%
  select(treatment_employment, treatment_education, treatment_retirement, treatment_cybersecurity) %>%
  summarise_all(funs(sum(!is.na(.))))
```

Yes, subjects in treatment answer all the questions. There are 295 subjects in treatment.

### Separate between treatment and control

```{r}
# filter for subjects in control
control <- d %>% filter(!is.na(control_employment) & 
                        !is.na(control_education) & 
                        !is.na(control_retirement) & 
                        !is.na(control_cybersecurity))
```

```{r}
# verify that control has 262 subjects
nrow(control) == 262
```

```{r}
# filter for subjects in treatment
treatment <- d %>% filter(!is.na(treatment_employment) & 
                          !is.na(treatment_education) & 
                          !is.na(treatment_retirement) & 
                          !is.na(treatment_cybersecurity))
```
```{r}
# verify that treatment has 295 subjects
nrow(treatment) == 295
```

### Explore the covariates

1. Gender: 
   There is slightly more male than female in the control group.
   There is slightly more female than male in the control group.
   Overall, they're equally distributed.

2. Age: 
   Age has a positively skewed distribution with subjects mostly in the age range of 25-34. 
   The distribution is approximately equal in treatment and control.
  
3. Highest education:
   The majority of the survey takers have a 4 year degree. 
   The distribution is approximately equal in treatment and control. 

4. Employment status:
   The majority of the subjects are employed full time. 
   The distribution is approximately equal in treatment and control.

5. Marital status:
   The majority of the participants are married, followed by them being never married. 
   The distribution is approximately equal in treatment and control. 

6. Zip code:


7. Community:
   Subjects are twice more likely to live in suburban than in rural or urban communities. 
   The distribution is approximately equal in treatment and control. 

8. Can vote: 
   Approximately 12% of the subjects cannot vote. 
   There are more subjects who cannot vote in the treatment group than in the control group, 
   but the majority of the people can vote. 

9. Political party:
   There are in general more Democrats taking the survey 
   followed by Independents then Republicans last.

10. Ethnicity: 
    The majority of the subjects are white. 
    The distribution is approximately equal in treatment and control.

11. Income: 
    The majority of the subjects make income around $20,000 - $49,999 range. 
    The distribution is positively skewed. 
    Treatment seems to have a slightly higher income overall but not by much.

12. Have kids:
    There are slightly more subjects having kids than no kids but not by much.

13. Internet access via mobile phone: 
    The majority of the subjects access their phone daily.

14. Internet access from home:
    The majority of the subjects access their internet daily from their home.

15. Internet access from work: 
    The majority of the subjects access their internet daily from their work.
    
16. Who pays for the internet:
    The majority of the subjects pay internet by themselves. 

17. Click counts: 
    There are slightly more clicks in treatment than in control.
    Both follow the same distribution, which is high click counts, on average, for the first question 
    then decreasing the number of click counts until the third question 
    before rising up on the fourth question. 
    
18. Duration in the question:
    On average, it takes the treatment group much longer to complete the question than the control group.

#### 1. Gender

```{r}
# gender frequency in the entire study
(total.gender.freq <- d %>% 
  group_by(gender) %>% 
  summarize(freq = sum(n()))) 
```

```{r}
# percentage of noncompliant for the entire study
total.gender.freq[which(total.gender.freq == ""),]$freq / sum(total.gender.freq$freq) * 100
# percentage of female for the entire study
total.gender.freq[which(total.gender.freq == "Female"),]$freq / sum(total.gender.freq$freq) * 100
# percentage of male for the entire study
total.gender.freq[which(total.gender.freq == "Male"),]$freq / sum(total.gender.freq$freq) * 100
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the gender frequency in the entire study
total.gender.bp <- barplot(total.gender.freq$freq, names.arg=total.gender.freq$gender, ylim=c(0,300))
text(total.gender.bp, 0, round(total.gender.freq$freq, 1), cex=1, pos=3)
```

**TOTAL**
no answer: 1 (0.1795332%)
female: 282 (50.62837%)
male: 274 (49.1921%)

There is almost equal number of male and female in the entire study.

```{r}
# gender frequency in the control group
(control.gender.freq <- control %>% 
  group_by(gender) %>% 
  summarize(freq = sum(n()))) 
```

```{r}
# percentage of noncompliant in the control group
control.gender.freq[which(control.gender.freq == ""),]$freq / sum(control.gender.freq$freq) * 100
# percentage of female in the control group
control.gender.freq[which(control.gender.freq == "Female"),]$freq / sum(control.gender.freq$freq) * 100
# percentage of male in the control group
control.gender.freq[which(control.gender.freq == "Male"),]$freq / sum(control.gender.freq$freq) * 100
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the gender frequency in the control group
control.gender.bp <- barplot(control.gender.freq$freq, names.arg=control.gender.freq$gender, ylim=c(0,300))
text(control.gender.bp, 0, round(control.gender.freq$freq, 1), cex=1, pos=3)
```

**CONTROL**
no answer: 1 (0.3816794%)
female: 127 (48.47328%)
male: 134 (51.14504%)

There is slightly more male than female in the control group.

```{r}
# gender frequency in the treatment group
(treatment.gender.freq <- treatment %>% 
  group_by(gender) %>% 
  summarize(freq = sum(n()))) 
```

```{r}
# percentage of female in the treatment group
treatment.gender.freq[which(treatment.gender.freq == "Female"),]$freq / sum(treatment.gender.freq$freq) * 100
# percentage of male in the treatment group
treatment.gender.freq[which(treatment.gender.freq == "Male"),]$freq / sum(treatment.gender.freq$freq) * 100
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the gender frequency in the treatment group
treatment.gender.bp <- barplot(treatment.gender.freq$freq, names.arg=treatment.gender.freq$gender, ylim=c(0,300))
text(treatment.gender.bp, 0, round(treatment.gender.freq$freq, 1), cex=1, pos=3)
```

**TREATMENT**
female: 155 (52.54237%)
male: 140 (47.45763%)

There is slightly more female than male in the treatment group.

#### 2. Age

```{r}
# age frequency in the entire study
total.age.freq <- d %>% 
  group_by(age) %>% 
  summarize(freq = sum(n()))
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the age frequency in the entire study
total.age.bp <- barplot(total.age.freq$freq, names.arg=total.age.freq$age, ylim=c(0,250))
text(total.age.bp, 0, round(total.age.freq$freq, 1), cex=1, pos=3)
```

```{r}
# age frequency in the control group
control.age.freq <- control %>% 
  group_by(age) %>% 
  summarize(freq = sum(n())) 
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the age frequency in the control group
control.age.bp <- barplot(control.age.freq$freq, names.arg=control.age.freq$age, ylim=c(0,250))
text(control.age.bp, 0, round(control.age.freq$freq, 1), cex=1, pos=3)
```

```{r}
# age frequency in the treatment group
treatment.age.freq <- treatment %>% 
  group_by(age) %>% 
  summarize(freq = sum(n())) 
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the age frequency in the treatment group
treatment.age.bp <- barplot(treatment.age.freq$freq, names.arg=treatment.age.freq$age, ylim=c(0,250))
text(treatment.age.bp, 0, round(treatment.age.freq$freq, 1), cex=1, pos=3)
```

Age has a positively skewed distribution with subjects mostly in the age range of 25-34. The distribution is approximately equal in treatment and control.

#### 3. Highest education

```{r}
highest_education.order <- c("Less than high school", "High school graduate", "Some college", "2 year degree", "4 year degree", "Doctorate", "Professional degree")
```

```{r}
# highest_education frequency in the entire study
total.highest_education.freq <- d %>% 
  group_by(highest_education) %>% 
  summarize(freq = sum(n())) %>%
  left_join(data.frame(highest_education=highest_education.order), .)
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the highest_education frequency in the entire study
par(mar=c(10,3,1,1))
total.highest_education.bp <- barplot(total.highest_education.freq$freq, names.arg=total.highest_education.freq$highest_education, ylim=c(0,200), las=2)
text(total.highest_education.bp, 0, round(total.highest_education.freq$freq, 1), cex=1, pos=3)
```

```{r}
# highest_education frequency in the control group
control.highest_education.freq <- control %>% 
  group_by(highest_education) %>% 
  summarize(freq = sum(n())) %>%
  left_join(data.frame(highest_education=highest_education.order), .)
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the highest_education frequency in the control group
par(mar=c(10,3,1,1))
control.highest_education.bp <- barplot(control.highest_education.freq$freq, names.arg=control.highest_education.freq$highest_education, ylim=c(0,200), las=2)
text(control.highest_education.bp, 0, round(control.highest_education.freq$freq, 1), cex=1, pos=3)
```

```{r}
# highest_education frequency in the treatment group
treatment.highest_education.freq <- treatment %>% 
  group_by(highest_education) %>% 
  summarize(freq = sum(n())) %>%
  left_join(data.frame(highest_education=highest_education.order), .)
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the highest_education frequency in the treatment group
par(mar=c(10,3,1,1))
treatment.highest_education.bp <- barplot(treatment.highest_education.freq$freq, names.arg=treatment.highest_education.freq$highest_education, ylim=c(0,200), las=2)
text(treatment.highest_education.bp, 0, round(treatment.highest_education.freq$freq, 1), cex=1, pos=3)
```

The majority of the survey takers have a 4 year degree. The distribution is approximately equal in treatment and control. 

#### 4. Employment status

```{r}
# employment_status frequency in the entire study
total.employment_status.freq <- d %>% 
  group_by(employment_status) %>% 
  summarize(freq = sum(n()))
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the employment_status frequency in the entire study
par(mar=c(16,3,1,1))
total.employment_status.bp <- barplot(total.employment_status.freq$freq, names.arg=total.employment_status.freq$employment_status, ylim=c(0,400), las=2)
text(total.employment_status.bp, 0, round(total.employment_status.freq$freq, 1), cex=1, pos=3)
```

```{r}
# employment_status frequency in the control group
control.employment_status.freq <- control %>% 
  group_by(employment_status) %>% 
  summarize(freq = sum(n())) 
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the employment_status frequency in the control group
par(mar=c(16,3,1,1))
control.employment_status.bp <- barplot(control.employment_status.freq$freq, names.arg=control.employment_status.freq$employment_status, ylim=c(0,200), las=2)
text(control.employment_status.bp, 0, round(control.employment_status.freq$freq, 1), cex=1, pos=3)
```

```{r}
# employment_status frequency in the treatment group
treatment.employment_status.freq <- treatment %>% 
  group_by(employment_status) %>% 
  summarize(freq = sum(n())) 
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the employment_status frequency in the treatment group
par(mar=c(16,3,1,1))
treatment.employment_status.bp <- barplot(treatment.employment_status.freq$freq, names.arg=treatment.employment_status.freq$employment_status, ylim=c(0,200), las=2)
text(treatment.employment_status.bp, 0, round(treatment.employment_status.freq$freq, 1), cex=1, pos=3)
```

The majority of the subjects are employed full time. The distribution is approximately equal in treatment and control. 

#### 5. Marital status

```{r}
# marital_status frequency in the entire study
total.marital_status.freq <- d %>% 
  group_by(marital_status) %>% 
  summarize(freq = sum(n()))
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the marital_status frequency in the entire study
par(mar=c(7,3,1,1))
total.marital_status.bp <- barplot(total.marital_status.freq$freq, names.arg=total.marital_status.freq$marital_status, ylim=c(0,400), las=2)
text(total.marital_status.bp, 0, round(total.marital_status.freq$freq, 1), cex=1, pos=3)
```

```{r}
# marital_status frequency in the control group
control.marital_status.freq <- control %>% 
  group_by(marital_status) %>% 
  summarize(freq = sum(n())) 
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the marital_status frequency in the control group
par(mar=c(7,3,1,1))
control.marital_status.bp <- barplot(control.marital_status.freq$freq, names.arg=control.marital_status.freq$marital_status, ylim=c(0,200), las=2)
text(control.marital_status.bp, 0, round(control.marital_status.freq$freq, 1), cex=1, pos=3)
```

```{r}
# marital_status frequency in the treatment group
treatment.marital_status.freq <- treatment %>% 
  group_by(marital_status) %>% 
  summarize(freq = sum(n())) 
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the marital_status frequency in the treatment group
par(mar=c(7,3,1,1))
treatment.marital_status.bp <- barplot(treatment.marital_status.freq$freq, names.arg=treatment.marital_status.freq$marital_status, ylim=c(0,200), las=2)
text(treatment.marital_status.bp, 0, round(treatment.marital_status.freq$freq, 1), cex=1, pos=3)
```

The majority of the participants are married, followed by them being never married. The distribution is approximately equal in treatment and control. 

#### 6. Zip code

TODO

#### 7. Community

```{r}
# community frequency in the entire study
total.community.freq <- d %>% 
  group_by(community) %>% 
  summarize(freq = sum(n()))
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the community frequency in the entire study
par(mar=c(7,3,1,1))
total.community.bp <- barplot(total.community.freq$freq, names.arg=total.community.freq$community, ylim=c(0,400), las=2)
text(total.community.bp, 0, round(total.community.freq$freq, 1), cex=1, pos=3)
```

```{r}
# community frequency in the control group
control.community.freq <- control %>% 
  group_by(community) %>% 
  summarize(freq = sum(n())) 
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the community frequency in the control group
par(mar=c(7,3,1,1))
control.community.bp <- barplot(control.community.freq$freq, names.arg=control.community.freq$community, ylim=c(0,200), las=2)
text(control.community.bp, 0, round(control.community.freq$freq, 1), cex=1, pos=3)
```

```{r}
# community frequency in the treatment group
treatment.community.freq <- treatment %>% 
  group_by(community) %>% 
  summarize(freq = sum(n())) 
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the community frequency in the treatment group
par(mar=c(7,3,1,1))
treatment.community.bp <- barplot(treatment.community.freq$freq, names.arg=treatment.community.freq$community, ylim=c(0,200), las=2)
text(treatment.community.bp, 0, round(treatment.community.freq$freq, 1), cex=1, pos=3)
```

Subjects are twice more likely to live in suburban than in rural or urban communities. The distribution is approximately equal in treatment and control. 

#### 8. Can vote

```{r}
# can_vote frequency in the entire study
total.can_vote.freq <- d %>% 
  group_by(can_vote) %>% 
  summarize(freq = sum(n()))
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the can_vote frequency in the entire study
par(mar=c(7,3,1,1))
total.can_vote.bp <- barplot(total.can_vote.freq$freq, names.arg=total.can_vote.freq$can_vote, ylim=c(0,400), las=2)
text(total.can_vote.bp, 0, round(total.can_vote.freq$freq, 1), cex=1, pos=3)
```

```{r}
# can_vote frequency in the control group
control.can_vote.freq <- control %>% 
  group_by(can_vote) %>% 
  summarize(freq = sum(n())) 
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the can_vote frequency in the control group
par(mar=c(7,3,1,1))
control.can_vote.bp <- barplot(control.can_vote.freq$freq, names.arg=control.can_vote.freq$can_vote, ylim=c(0,200), las=2)
text(control.can_vote.bp, 0, round(control.can_vote.freq$freq, 1), cex=1, pos=3)
```

```{r}
# can_vote frequency in the treatment group
treatment.can_vote.freq <- treatment %>% 
  group_by(can_vote) %>% 
  summarize(freq = sum(n())) 
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the can_vote frequency in the treatment group
par(mar=c(7,3,1,1))
treatment.can_vote.bp <- barplot(treatment.can_vote.freq$freq, names.arg=treatment.can_vote.freq$can_vote, ylim=c(0,200), las=2)
text(treatment.can_vote.bp, 0, round(treatment.can_vote.freq$freq, 1), cex=1, pos=3)
```

Approximately 12% of the subjects cannot vote. There are more subjects who cannot vote in the treatment group than in the control group, but the majority of the people can vote. 

#### 9. Political party

```{r}
# political_party frequency in the entire study
total.political_party.freq <- d %>% 
  group_by(political_party) %>% 
  summarize(freq = sum(n()))
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the political_party frequency in the entire study
par(mar=c(10,3,1,1))
total.political_party.bp <- barplot(total.political_party.freq$freq, names.arg=total.political_party.freq$political_party, ylim=c(0,300), las=2)
text(total.political_party.bp, 0, round(total.political_party.freq$freq, 1), cex=1, pos=3)
```

```{r}
# political_party frequency in the control group
control.political_party.freq <- control %>% 
  group_by(political_party) %>% 
  summarize(freq = sum(n())) 
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the political_party frequency in the control group
par(mar=c(10,3,1,1))
control.political_party.bp <- barplot(control.political_party.freq$freq, names.arg=control.political_party.freq$political_party, ylim=c(0,150), las=2)
text(control.political_party.bp, 0, round(control.political_party.freq$freq, 1), cex=1, pos=3)
```

```{r}
# political_party frequency in the treatment group
treatment.political_party.freq <- treatment %>% 
  group_by(political_party) %>% 
  summarize(freq = sum(n())) 
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the political_party frequency in the treatment group
par(mar=c(10,3,1,1))
treatment.political_party.bp <- barplot(treatment.political_party.freq$freq, names.arg=treatment.political_party.freq$political_party, ylim=c(0,150), las=2)
text(treatment.political_party.bp, 0, round(treatment.political_party.freq$freq, 1), cex=1, pos=3)
```

There are in general more Democrats taking the survey followed by Independents then Republicans last.

#### 10. Ethnicity

```{r}
# ethnicity frequency in the entire study
total.ethnicity.freq <- d %>% 
  group_by(ethnicity) %>% 
  summarize(freq = sum(n()))
```

```{r}
total.ethnicity.freq
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the ethnicity frequency in the entire study
par(mar=c(8,3,1,1))
total.ethnicity.bp <- barplot(total.ethnicity.freq$freq, names.arg=total.ethnicity.freq$ethnicity, ylim=c(0,600), las=2)
text(total.ethnicity.bp, 0, round(total.ethnicity.freq$freq, 1), cex=1, pos=3)
```

```{r}
# ethnicity frequency in the control group
control.ethnicity.freq <- control %>% 
  group_by(ethnicity) %>% 
  summarize(freq = sum(n())) 
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the ethnicity frequency in the control group
par(mar=c(8,3,1,1))
control.ethnicity.bp <- barplot(control.ethnicity.freq$freq, names.arg=control.ethnicity.freq$ethnicity, ylim=c(0,250), las=2)
text(control.ethnicity.bp, 0, round(control.ethnicity.freq$freq, 1), cex=1, pos=3)
```

```{r}
# ethnicity frequency in the treatment group
treatment.ethnicity.freq <- treatment %>% 
  group_by(ethnicity) %>% 
  summarize(freq = sum(n())) 
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the ethnicity frequency in the treatment group
par(mar=c(8,3,1,1))
treatment.ethnicity.bp <- barplot(treatment.ethnicity.freq$freq, names.arg=treatment.ethnicity.freq$ethnicity, ylim=c(0,250), las=2)
text(treatment.ethnicity.bp, 0, round(treatment.ethnicity.freq$freq, 1), cex=1, pos=3)
```

The majority of the subjects are white. The distribution is approximately equal in treatment and control. 
#### 11. Income

```{r}
income.order <- c("Less than $10,000", "$10,000 - $19,999", "$20,000 - $29,999", "$30,000 - $39,999",
                  "$40,000 - $49,999", "$50,000 - $59,999", "$60,000 - $69,999", "$70,000 - $79,999",
                  "$80,000 - $89,999", "$90,000 - $99,999", "$100,000 - $149,999", "More than $150,000",
                  "Rather not say")
```

```{r}
# income frequency in the entire study
total.income.freq <- d %>% 
  group_by(income) %>% 
  summarize(freq = sum(n())) %>%
  left_join(data.frame(income=income.order), .)
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the income frequency in the entire study
par(mar=c(10,3,1,1))
total.income.bp <- barplot(total.income.freq$freq, names.arg=total.income.freq$income, ylim=c(0,100), las=2)
text(total.income.bp, 0, round(total.income.freq$freq, 1), cex=1, pos=3)
```

```{r}
# income frequency in the control group
control.income.freq <- control %>% 
  group_by(income) %>% 
  summarize(freq = sum(n())) %>%
  left_join(data.frame(income=income.order), .)
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the income frequency in the control group
par(mar=c(10,3,1,1))
control.income.bp <- barplot(control.income.freq$freq, names.arg=control.income.freq$income, ylim=c(0,50), las=2)
text(control.income.bp, 0, round(control.income.freq$freq, 1), cex=1, pos=3)
```

```{r}
# income frequency in the treatment group
treatment.income.freq <- treatment %>% 
  group_by(income) %>% 
  summarize(freq = sum(n())) %>%
  left_join(data.frame(income=income.order), .)
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the income frequency in the treatment group
par(mar=c(10,3,1,1))
treatment.income.bp <- barplot(treatment.income.freq$freq, names.arg=treatment.income.freq$income, ylim=c(0,50), las=2)
text(treatment.income.bp, 0, round(treatment.income.freq$freq, 1), cex=1, pos=3)
```

The majority of the subjects make income around $20,000 - $49,999 range. Treatment seems to have a slightly higher income overall but not by much.

#### 12. Have kids

```{r}
# have_kids frequency in the entire study
total.have_kids.freq <- d %>% 
  group_by(have_kids) %>% 
  summarize(freq = sum(n()))
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the have_kids frequency in the entire study
par(mar=c(8,3,1,1))
total.have_kids.bp <- barplot(total.have_kids.freq$freq, names.arg=total.have_kids.freq$have_kids, ylim=c(0,600), las=2)
text(total.have_kids.bp, 0, round(total.have_kids.freq$freq, 1), cex=1, pos=3)
```

```{r}
# have_kids frequency in the control group
control.have_kids.freq <- control %>% 
  group_by(have_kids) %>% 
  summarize(freq = sum(n())) 
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the have_kids frequency in the control group
par(mar=c(8,3,1,1))
control.have_kids.bp <- barplot(control.have_kids.freq$freq, names.arg=control.have_kids.freq$have_kids, ylim=c(0,250), las=2)
text(control.have_kids.bp, 0, round(control.have_kids.freq$freq, 1), cex=1, pos=3)
```

```{r}
# have_kids frequency in the treatment group
treatment.have_kids.freq <- treatment %>% 
  group_by(have_kids) %>% 
  summarize(freq = sum(n())) 
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the have_kids frequency in the treatment group
par(mar=c(8,3,1,1))
treatment.have_kids.bp <- barplot(treatment.have_kids.freq$freq, names.arg=treatment.have_kids.freq$have_kids, ylim=c(0,250), las=2)
text(treatment.have_kids.bp, 0, round(treatment.have_kids.freq$freq, 1), cex=1, pos=3)
```

There are slightly more subjects having kids than no kids but not by much.

#### 13. How often they access internet from their mobile phones

```{r}
internet_from_mobile.order <- c("I do not have a mobile phone", "Never", "Less than once a month", "Monthly", "Weekly", "Daily")
```

```{r}
# internet_from_mobile frequency in the entire study
total.internet_from_mobile.freq <- d %>% 
  group_by(internet_from_mobile) %>% 
  summarize(freq = sum(n())) %>%
  left_join(data.frame(internet_from_mobile=internet_from_mobile.order), .)
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the internet_from_mobile frequency in the entire study
par(mar=c(10,3,1,1))
total.internet_from_mobile.bp <- barplot(total.internet_from_mobile.freq$freq, names.arg=total.internet_from_mobile.freq$internet_from_mobile, ylim=c(0, 600), las=2)
text(total.internet_from_mobile.bp, 0, round(total.internet_from_mobile.freq$freq, 1), cex=1, pos=3)
```

```{r}
# internet_from_mobile frequency in the control group
control.internet_from_mobile.freq <- control %>% 
  group_by(internet_from_mobile) %>% 
  summarize(freq = sum(n())) %>%
  left_join(data.frame(internet_from_mobile=internet_from_mobile.order), .)
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the internet_from_mobile frequency in the control group
par(mar=c(10,3,1,1))
control.internet_from_mobile.bp <- barplot(control.internet_from_mobile.freq$freq, names.arg=control.internet_from_mobile.freq$internet_from_mobile, ylim=c(0,250), las=2)
text(control.internet_from_mobile.bp, 0, round(control.internet_from_mobile.freq$freq, 1), cex=1, pos=3)
```

```{r}
# internet_from_mobile frequency in the treatment group
treatment.internet_from_mobile.freq <- treatment %>% 
  group_by(internet_from_mobile) %>% 
  summarize(freq = sum(n())) %>%
  left_join(data.frame(internet_from_mobile=internet_from_mobile.order), .)
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the internet_from_mobile frequency in the treatment group
par(mar=c(10,3,1,1))
treatment.internet_from_mobile.bp <- barplot(treatment.internet_from_mobile.freq$freq, names.arg=treatment.internet_from_mobile.freq$internet_from_mobile, ylim=c(0,250), las=2)
text(treatment.internet_from_mobile.bp, 0, round(treatment.internet_from_mobile.freq$freq, 1), cex=1, pos=3)
```

The majority of the subjects access their phone daily.

#### 14. How often they access internet from home

```{r}
internet_from_home.order <- c("I do not have internet at my house", "Never", "Less than once a month", "Monthly", "Weekly", "Daily")
```

```{r}
# internet_from_home frequency in the entire study
total.internet_from_home.freq <- d %>% 
  group_by(internet_from_home) %>% 
  summarize(freq = sum(n())) %>%
  left_join(data.frame(internet_from_home=internet_from_home.order), .)
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the internet_from_home frequency in the entire study
par(mar=c(10,3,1,1))
total.internet_from_home.bp <- barplot(total.internet_from_home.freq$freq, names.arg=total.internet_from_home.freq$internet_from_home, ylim=c(0, 600), las=2)
text(total.internet_from_home.bp, 0, round(total.internet_from_home.freq$freq, 1), cex=1, pos=3)
```

```{r}
# internet_from_home frequency in the control group
control.internet_from_home.freq <- control %>% 
  group_by(internet_from_home) %>% 
  summarize(freq = sum(n())) %>%
  left_join(data.frame(internet_from_home=internet_from_home.order), .)
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the internet_from_home frequency in the control group
par(mar=c(10,3,1,1))
control.internet_from_home.bp <- barplot(control.internet_from_home.freq$freq, names.arg=control.internet_from_home.freq$internet_from_home, ylim=c(0,300), las=2)
text(control.internet_from_home.bp, 0, round(control.internet_from_home.freq$freq, 1), cex=1, pos=3)
```

```{r}
# internet_from_home frequency in the treatment group
treatment.internet_from_home.freq <- treatment %>% 
  group_by(internet_from_home) %>% 
  summarize(freq = sum(n())) %>%
  left_join(data.frame(internet_from_home=internet_from_home.order), .)
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the internet_from_home frequency in the treatment group
par(mar=c(10,3,1,1))
treatment.internet_from_home.bp <- barplot(treatment.internet_from_home.freq$freq, names.arg=treatment.internet_from_home.freq$internet_from_home, ylim=c(0,300), las=2)
text(treatment.internet_from_home.bp, 0, round(treatment.internet_from_home.freq$freq, 1), cex=1, pos=3)
```

The majority of the subjects access their internet daily from their home.

#### 15. How often they access internet from work

```{r}
internet_from_work.order <- c("I am currently not working", "Never", "Less than once a month", "Monthly", "Weekly", "Daily")
```

```{r}
# internet_from_work frequency in the entire study
total.internet_from_work.freq <- d %>% 
  group_by(internet_from_work) %>% 
  summarize(freq = sum(n())) %>%
  left_join(data.frame(internet_from_work=internet_from_work.order), .)
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the internet_from_work frequency in the entire study
par(mar=c(10,3,1,1))
total.internet_from_work.bp <- barplot(total.internet_from_work.freq$freq, names.arg=total.internet_from_work.freq$internet_from_work, ylim=c(0, 500), las=2)
text(total.internet_from_work.bp, 0, round(total.internet_from_work.freq$freq, 1), cex=1, pos=3)
```

```{r}
# internet_from_work frequency in the control group
control.internet_from_work.freq <- control %>% 
  group_by(internet_from_work) %>% 
  summarize(freq = sum(n())) %>%
  left_join(data.frame(internet_from_work=internet_from_work.order), .)
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the internet_from_work frequency in the control group
par(mar=c(10,3,1,1))
control.internet_from_work.bp <- barplot(control.internet_from_work.freq$freq, names.arg=control.internet_from_work.freq$internet_from_work, ylim=c(0,250), las=2)
text(control.internet_from_work.bp, 0, round(control.internet_from_work.freq$freq, 1), cex=1, pos=3)
```

```{r}
# internet_from_work frequency in the treatment group
treatment.internet_from_work.freq <- treatment %>% 
  group_by(internet_from_work) %>% 
  summarize(freq = sum(n())) %>%
  left_join(data.frame(internet_from_work=internet_from_work.order), .)
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the internet_from_work frequency in the treatment group
par(mar=c(10,3,1,1))
treatment.internet_from_work.bp <- barplot(treatment.internet_from_work.freq$freq, names.arg=treatment.internet_from_work.freq$internet_from_work, ylim=c(0,250), las=2)
text(treatment.internet_from_work.bp, 0, round(treatment.internet_from_work.freq$freq, 1), cex=1, pos=3)
```

The majority of the subjects access their internet daily from their work.

#### 16. Who pays the internet

```{r}
# who_pays_internet frequency in the entire study
total.who_pays_internet.freq <- d %>% 
  group_by(who_pays_internet) %>% 
  summarize(freq = sum(n()))
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the who_pays_internet frequency in the entire study
par(mar=c(8,3,1,1))
total.who_pays_internet.bp <- barplot(total.who_pays_internet.freq$freq, names.arg=total.who_pays_internet.freq$who_pays_internet, ylim=c(0,600), las=2)
text(total.who_pays_internet.bp, 0, round(total.who_pays_internet.freq$freq, 1), cex=1, pos=3)
```

```{r}
# who_pays_internet frequency in the control group
control.who_pays_internet.freq <- control %>% 
  group_by(who_pays_internet) %>% 
  summarize(freq = sum(n())) 
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the who_pays_internet frequency in the control group
par(mar=c(8,3,1,1))
control.who_pays_internet.bp <- barplot(control.who_pays_internet.freq$freq, names.arg=control.who_pays_internet.freq$who_pays_internet, ylim=c(0,250), las=2)
text(control.who_pays_internet.bp, 0, round(control.who_pays_internet.freq$freq, 1), cex=1, pos=3)
```

```{r}
# who_pays_internet frequency in the treatment group
treatment.who_pays_internet.freq <- treatment %>% 
  group_by(who_pays_internet) %>% 
  summarize(freq = sum(n())) 
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
# plot the who_pays_internet frequency in the treatment group
par(mar=c(8,3,1,1))
treatment.who_pays_internet.bp <- barplot(treatment.who_pays_internet.freq$freq, names.arg=treatment.who_pays_internet.freq$who_pays_internet, ylim=c(0,250), las=2)
text(treatment.who_pays_internet.bp, 0, round(treatment.who_pays_internet.freq$freq, 1), cex=1, pos=3)
```

The majority of the subjects pay internet by themselves. 

#### 17. Click counts

```{r}
# summary of click count per control question
summary(control$control_employment_Click.Count)
summary(control$control_education_Click.Count)
summary(control$control_retirement_Click.Count)
summary(control$control_cybersecurity_Click.Count)
```

```{r}
# summary of click count per treatment question
summary(treatment$treatment_employment_Click.Count)
summary(treatment$treatment_education_Click.Count)
summary(treatment$treatment_retirement_Click.Count)
summary(treatment$treatment_cybersecurity_Click.Count)
```


```{r out.width="49%", fig.align="center", fig.show="hold"}
boxplot(control$control_employment_Click.Count,
  control$control_education_Click.Count,
  control$control_retirement_Click.Count,
  control$control_cybersecurity_Click.Count, 
  main="control's click count",
  names=c("employment", "education\n(baseline)", "retirement", "cybersecurity"))

boxplot(treatment$treatment_employment_Click.Count,
  treatment$treatment_education_Click.Count,
  treatment$treatment_retirement_Click.Count,
  treatment$treatment_cybersecurity_Click.Count, 
  main="treatment's click count",
  names=c("employment", "education\n(baseline)", "retirement", "cybersecurity"))
```

There are slightly more clicks in treatment than in control, but both follow the same distribution, which is high click counts, on average, for the first question then decreasing the number of click counts until the third question before rising up on the fourth question. 

#### 18. Length of time spent on each question

Since we supress the next button for 30 seconds, we should see that each subject spends on each question 30 seconds or longer. 

```{r}
# summary of duration per control question
summary(control$control_employment_Page.Submit)
summary(control$control_education_Page.Submit)
summary(control$control_retirement_Page.Submit)
summary(control$control_cybersecurity_Page.Submit)
```

```{r}
# summary of duration per treatment question
summary(treatment$treatment_employment_Page.Submit)
summary(treatment$treatment_education_Page.Submit)
summary(treatment$treatment_retirement_Page.Submit)
summary(treatment$treatment_cybersecurity_Page.Submit)
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
boxplot(control$control_employment_Page.Submit,
  control$control_education_Page.Submit,
  control$control_retirement_Page.Submit,
  control$control_cybersecurity_Page.Submit, 
  main="control's duration (sec) in each question",
  names=c("employment", "education\n(baseline)", "retirement", "cybersecurity"))

boxplot(treatment$treatment_employment_Page.Submit,
  treatment$treatment_education_Page.Submit,
  treatment$treatment_retirement_Page.Submit,
  treatment$treatment_cybersecurity_Page.Submit, 
  main="treatment's duration (sec) in each question",
  names=c("employment", "education\n(baseline)", "retirement", "cybersecurity"))
```

On average, it takes the treatment group much longer to complete the question than the control group.

```{r}
# number of subjects in control who took each question less than 30 seconds
nrow(control[which(control$control_employment_Duration.in.sec < 30),])
nrow(control[which(control$control_education_Duration.in.sec < 30),])
nrow(control[which(control$control_retirement_Duration.in.sec < 30),])
nrow(control[which(control$control_cybersecurity_Duration.in.sec < 30),])
```

```{r}
# number of subjects in control
nrow(control)
```

```{r}
# number of subjects in treatment who toko each question less than 30 seconds
nrow(treatment[which(treatment$treatment_employment_Duration.in.sec < 30),])
nrow(treatment[which(treatment$treatment_education_Duration.in.sec < 30),])
nrow(treatment[which(treatment$treatment_retirement_Duration.in.sec < 30),])
nrow(treatment[which(treatment$treatment_cybersecurity_Duration.in.sec < 30),])
```

```{r}
# number of subjects in treatment
nrow(treatment)
```

### Cross Section of Covariates

**TODO**

a pre-analysis/EDA, just looking at some plots of scores for each answer, with a few cuts by covariates (e.g. histograms by political preference, gender; box-whisker plots for age groups, etc.)

1. age x gender

2. Employment: age x employment, gender x employment, ethnicity x employment, educ x employment

```{r out.width="49%", fig.align="center", fig.show="hold"}
# cross section of education vs employment
educXemp <- d %>% 
  group_by(highest_education, employment_status) %>% 
  summarize(freq = sum(n()))

```

3. Income: ... x income: should see similar result as ... x employment

4. Community: married x community, have_kids x community

5. Party: age x party, gender x party, ethnicity x party, educ x party, income x party, community x party
   can_vote x party


### Analysis of each research question

2) then, for each question, starting with our education placebo test, we have a _stargazer_ output that has 3 regressions: a) with only the treatment dummy, b) with treatment plus key covariates, and c) with treatment, key covariates AND interaction terms (i.e. HTEs)

* Block on: political_party

* Key covarites for each question:

  * employment: income, employment_status

  * (baseline) education: income, highest_education

  * retirement: income, age

  * cybersecurity: internet_from_mobile, internet_from_home, internet_from_work, who_pays_internet

* other covariates: can_vote, gender, age, ethnicity, marital_status, have_kids, zip_code, click_counts, duration

all covariates: gender, age, highest_education, employment_status, marital_status, zip_code, community, can_vote, political_party, ethnicity, income, have_kids, internet_from_mobile, internet_from_home, internet_from_work, who_pays_internet, click_counts, duration


```{r}
# summary of sentiment result for each control question
summary(control$control_employment)
summary(control$control_education)
summary(control$control_retirement)
summary(control$control_cybersecurity)
```

```{r}
# summary of sentiment result for each treatment question
summary(treatment$treatment_employment)
summary(treatment$treatment_education)
summary(treatment$treatment_retirement)
summary(treatment$treatment_cybersecurity)
```

```{r out.width="49%", fig.align="center", fig.show="hold"}
boxplot(control$control_employment,
  control$control_education,
  control$control_retirement,
  control$control_cybersecurity, 
  main="control's sentiment result for each question",
  names=c("employment", "education\n(baseline)", "retirement", "cybersecurity"))

boxplot(treatment$treatment_employment,
  treatment$treatment_education,
  treatment$treatment_retirement,
  treatment$treatment_cybersecurity, 
  main="treatment's sentiment result for each question",
  names=c("employment", "education\n(baseline)", "retirement", "cybersecurity"))
```

```{r}
library(ggplot2)

ggplot(control, aes(age, fill=control_education, colour=control_education)) + geom_density(alpha=0.2)
```


#### (Baseline) Education

Education is the second question we asked in both treatment and control. It acts as our baseline because it does not include the name of our president. 

block: political_party
covariate: highest_education + income_class
interaction term: highest_education * income_class

We define income class as follows:
* poor: $39,999 and below
* middle: $40,000 - $149,999
* rich: $150,000 and above

```{r}
# define income class
define_income_class <- function(income_range) {
  if(income_range %in% c("Less than $10,000", "$20,000 - $29,999", "$30,000 - $39,999")) {
    return(factor("poor"))
  } else if(income_range == "More than $150,000") {
    return(factor("rich"))
  } else {
    return(factor("middle"))
  }
}
control$income_class <- sapply(control$income, define_income_class)
treatment$income_class <- sapply(treatment$income, define_income_class)
```

```{r}
# control
control %>% 
  lm(control_education ~ political_party + highest_education + income_class + 
                         highest_education * income_class,
     data = .) %>%
  # coeftest(., vcovHC(.))
  summary(.)
```

There are no significant outlook subjects in control have over the education system.

```{r}
# treatment
treatment %>% 
  lm(treatment_education ~ political_party + highest_education + income_class + 
                           highest_education * income_class,
     data = .) %>%
  # coeftest(., vcovHC(.))
  summary(.)
```

There should not be any difference between control and treatment for this particular question because the question is the same. However, there is a significance at the 0.05 level among subjects who attain some college degree and are in the middle class. They have a positive outlook of education in preparing students to enter the workforce by an additional 21 points in the optimistic scale from 1 - 100, where 1 is not optimistic and 100 is very optimistic. We wonder if it was partially due to the residual effect from the first question having the treatment onto the baseline.

backup: data, d.backup

```{r}
treatment
```


```{r}
table(d$political_party)
```


```{r}
# 
d$treatment_ind <- ifelse(is.na(d$control_cybersecurity_Page.Submit), 1, 0)


# 4.
d$employment_score <- ifelse(is.na(d$treatment_employment), d$control_employment, d$treatment_employment)
d$education_score <- ifelse(is.na(d$treatment_education), d$control_education, d$treatment_education)
d$retirement_score <- ifelse(is.na(d$treatment_retirement), d$control_retirement, d$treatment_retirement)
d$cybersecurity_score <- ifelse(is.na(d$treatment_cybersecurity), d$control_cybersecurity, d$treatment_cybersecurity)
```

```{r}
table(d$income)
```



```{r, results='asis'}

#to-do: REORDER FACTOR VARS IN BOXPLOTS

# define income class - not a strong candidate for regression
table(d$income)
par(mar=c(10,3,1,1))
boxplot(d$education_score ~ d$income, data=d, las = 2, horizontal=F)


define_income_class <- function(income_range) {
  if(income_range %in% c("Less than $10,000", "$20,000 - $29,999", "$30,000 - $39,999")) {
    return("low")
  } else if(income_range %in% c("$80,000 - $89,999", "$90,000 - $99,999", "$100,000 - $149,999", "More than $150,000")) {
    return("high")
  } else if(income_range %in% c("$40,000 - $49,999","$50,000 - $59,999","$60,000 - $69,999","$70,000 - $79,999")){
    return("middle")
  } else {
    return("unknown")
  }
}
d$income_group <- relevel(factor(sapply(d$income, define_income_class)), "middle")
table(d$income_group)


# grouping for education level - not a strong predictor
table(d$highest_education)
par(mar=c(10,3,1,1))
boxplot(education_score~highest_education, data=d, las = 2, horizontal=F)

define_education <- function(ed) {
  if(ed %in% c("4 year degree", "Doctorate", "Professional degree")) {
    return(1)
  } else {
    return(0)
  }
}
d$high_ed_ind <- sapply(d$highest_education, define_education)
table(d$high_ed_ind)


#ADD AGE GROUP (e.g. 45+; to be revised/informed by EDA later)
summary(d$age)
boxplot(education_score~age, data=d)

define_age <- function(age) {
  if(age %in% c("18 - 24", "25 - 34", "35 - 44")) {
    return("18 - 44")
  } else if (age %in% c("45 - 54", "55 - 64", "65 - 74")){
    return("over 45")
  } 
  else {
    return("other")
  }
}
d$age_group <- relevel(factor(sapply(d$age, define_age)), "18 - 44")
summary(d$age_group)


lm.ed.1 <- lm(education_score ~ treatment_ind, data = d)
lm.ed.2 <- lm(education_score ~ treatment_ind + political_party + high_ed_ind + age_group, data = d)
lm.ed.3 <- lm(education_score ~ treatment_ind + 
                                treatment_ind*political_party + 
                                treatment_ind*high_ed_ind +
                                treatment_ind*age_group, data = d)

# SWITCH FROM "text" TO "latex" FOR FINAL OUTPUTS
stargazer(lm.ed.1, lm.ed.2, lm.ed.3, title = "Value on Education", type = "text",
          column.labels = c("Treatment Only","With Covariates", "With HTEs"),
          dep.var.labels = "Education Feeling Score (0 to 100)")
```

#### Employment

block: political_party
covariate: employment_status + income_class
interaction term: employment_status * income_class

```{r}
# control
control %>% 
  lm(control_employment ~ political_party + employment_status + income + 
                          employment_status * income,
     data = .) %>%
  # coeftest(., vcovHC(.))
  summary(.)
```

There are no significant outlook subjects in control have over the general employment for the next two decades. 

```{r}
# treatment
treatment %>% 
  lm(treatment_employment ~ political_party + employment_status + income_class + 
                            employment_status * income_class, 
     data = .) %>%
  # coeftest(., vcovHC(.))
  summary(.)
```

Republicans view the general employment outlook over the next two decades positively by an additional 6 points in the optimistic scale from 1 - 100, where 1 is not optimistic and 100 is very optimistic.

```{r, results='asis'}
# UPDATED REGRESSIONS: Employment (make sure reults='asis' above!)

#to-do: REORDER FACTOR VARS IN BOXPLOTS

#income - strong candidate
par(mar=c(10,3,1,1))
boxplot(employment_score~income, data=d, las = 2, horizontal=F)

#age - modest candidate
par(mar=c(10,3,1,1))
boxplot(employment_score~age, data=d, las = 2, horizontal=F)

#education - not a compelling candidate
par(mar=c(10,3,1,1))
boxplot(employment_score~highest_education, data=d, las = 2, horizontal=F)




lm.emp.1 <- lm(employment_score ~ treatment_ind, data = d)
lm.emp.2 <- lm(employment_score ~ treatment_ind + political_party + income_group + age_group, data = d)
lm.emp.3 <- lm(employment_score ~ treatment_ind + treatment_ind*political_party + treatment_ind*income_group +
                 treatment_ind*age_group, data = d)

# SWITCH TO "LATEX" FOR FINAL OUTPUT
stargazer(lm.emp.1, lm.emp.2, lm.emp.3, title = "Employment Optimism", type = "text",
          column.labels = c("Treatment Only","With Covariates", "With HTEs"),
          dep.var.labels = "Employment Feeling Score (0 to 100)")
```


#### Retirement

block: political_party
covariate: age + income_class
interaction term: age * income_class

```{r}
# control
control %>% 
  lm(control_retirement ~ political_party + age + income + 
                          age * income,
     data = .) %>%
  # coeftest(., vcovHC(.))
  summary(.)
```

There are no significant outlook subjects in control have over their prospect for saving enough for retirement. 

```{r}
# treatment
treatment %>% 
  lm(treatment_employment ~ political_party + age + income + 
                            age * income,
     data = .) %>%
  # coeftest(., vcovHC(.))
  summary(.)
```

Republicans view their prospects for saving enough for retirement positively by an additional 16 points in the optimistic scale from 1 - 100, where 1 is not optimistic and 100 is very optimistic. In addition, subjects who are close to the retirement age (age 55-64) and are making less than $10,000 view their prospects for saving enough for retirement negatively by -58 points in the optimistic scale. 

```{r, results='asis'}
# UPDATED REGRESSIONS: Retirement (make sure reults='asis' above!)

#to-do: REORDER FACTOR VARS IN BOXPLOTS

#income - strong candidate
par(mar=c(10,3,1,1))
boxplot(retirement_score~income, data=d, las = 2, horizontal=F)

#age - relationship looks curved candidate
par(mar=c(10,3,1,1))
boxplot(retirement_score~age, data=d, las = 2, horizontal=F)

#education - not a compelling candidate
par(mar=c(10,3,1,1))
boxplot(retirement_score~highest_education, data=d, las = 2, horizontal=F)



lm.ret.1 <- lm(retirement_score ~ treatment_ind, data = d)
lm.ret.2 <- lm(retirement_score ~ treatment_ind + political_party + age_group + high_ed_ind + income_group, data = d)
lm.ret.3 <- lm(retirement_score ~ treatment_ind + treatment_ind*political_party + treatment_ind*age_group + 
                 treatment_ind*high_ed_ind + treatment_ind*income_group, data = d)

# SWITCH TO "LATEX" FOR FINAL OUTPUT
stargazer(lm.ret.1, lm.ret.2, lm.ret.3, title = "Retirement Optimism", type = "text",
          column.labels = c("Treatment Only","With Covariates", "With HTEs"),
          dep.var.labels = "Retirement Feeling Score (0 to 100)")
```

#### Cybersecurity

block: political_party
covariate: internet_from_mobile, internet_from_home, internet_from_work, who_pays_internet, income  
interaction term: income_class * internet_from_work

```{r}
# control
control %>% 
  lm(control_cybersecurity ~ political_party + internet_from_mobile + internet_from_home +
                             internet_from_work + who_pays_internet + income_class + 
                             internet_from_work * income_class,
     data = .) %>%
  # coeftest(., vcovHC(.))
  summary(.)
```

Democrats view cyberattacks a low threat to their general livelihood, having -10 points lower in the threat level scale where 1 is very low threat and 100 is very high threat.

```{r}
# treatment
treatment %>% 
  lm(treatment_cybersecurity ~ political_party + internet_from_mobile + internet_from_home +
                               internet_from_work + who_pays_internet + income_class + 
                               internet_from_work * income_class,
     data = .) %>%
  #coeftest(., vcovHC(.))
  summary(.)
```

The middle class in general are more concerned about their cybersecurity threat when presented with the treatment of our president's name in the brief excerpt. 

TODO: figure out why political party is not showing up in the output...potentially correlated?

```{r}
write.csv(d, "filtered_data.csv")
write.csv(control, "control_filtered_data.csv")
write.csv(treatment, "treatment_filtered_data.csv")
```



```{r, results='asis'}
# UPDATED REGRESSIONS: Cybersecurity (make sure reults='asis' above!)

#to-do: REORDER FACTOR VARS IN BOXPLOTS

#income - poor candidate
par(mar=c(10,3,1,1))
boxplot(cybersecurity_score~income, data=d, las = 2, horizontal=F)

#age - modest candidate
par(mar=c(10,3,1,1))
boxplot(cybersecurity_score~age, data=d, las = 2, horizontal=F)

#education - not a compelling candidate
par(mar=c(10,3,1,1))
boxplot(cybersecurity_score~highest_education, data=d, las = 2, horizontal=F)

#INTERNET USAGE - overwhelmingly users use internet daily; no control necessary



lm.sec.1 <- lm(cybersecurity_score ~ treatment_ind, data = d)
lm.sec.2 <- lm(cybersecurity_score ~ treatment_ind + political_party + age_group, data = d)
lm.sec.3 <- lm(cybersecurity_score ~ treatment_ind + 
                                     treatment_ind*political_party + 
                                     treatment_ind*age_group, data = d)

# SWITCH TO "LATEX" FOR FINAL OUTPUT
stargazer(lm.sec.1, lm.sec.2, lm.sec.3, title = "Cybersecurity Risk", type = "text",
          column.labels = c("Treatment Only","With Covariates", "With HTEs"),
          dep.var.labels = "Cybersecurity Risk Feeling Score (0 to 100)")
```

## Questions to answer

1. In 30 seconds: What is your research question? Why is an experiment necessary?
2. In 30 seconds: What is the specific hypothesis that you are testing that is implied by theory of your question? What direction do you expect your outcomes to moe as a consequence of treatment?
3. In 60 seconds: What is your treatment? Be specific. Show pictures of it, show the language that you used, etc. For me or the class to understand what you did, we need to understand what you did.
4. In 30 seconds: explain who/what your measurement units are. People? From where? Robots? What type?
5. In 30 seconds: How did you randomize and did it work?
6. Present a flow document like in Box 13.3
7. In 60 seconds: Draw out using the ROXO grammar your experiment design, describe the comparisons that you are going to make that tell you something causal. Call this RDD or a D-n-D, or a within subjects or a between subjects comparison.
8. In 60 seconds: Describe your outcome measures. What are they? How are they related to the concept that motivated this experiment? What are they distributed like?
9. In 180 seconds: Describe your analysis, results.
10. In 30 seconds: List the questions and concerns that you want your peers to help you puzzle through.
11. Share slides with class at least 24 hours before the presentation.

## References

1. https://www.huffingtonpost.com/entry/trump-optimism-american-public-polls_us_5a7140dbe4b0be822ba17210


1. renaming column names: http://rprogramming.net/rename-columns-in-r/ 
2. interaction terms: http://statisticsbyjim.com/regression/interaction-effects/ 

## Unused stuff

### IP
Get state, country information from IPs. IPs are not reliable though. Plus, it's dang slow.

```
freegeoip <- function(ip, format = ifelse(length(ip)==1,'list','dataframe'))
{
    if (1 == length(ip))
    {
        # a single IP address
        url <- paste(c("http://api.ipstack.com/", ip, "?access_key=0e93a4defcd645bd8829ad75a7223437&output=json&legacy=1/"), collapse='')
        ret <- fromJSON(readLines(url, warn=FALSE))
        if (format == 'dataframe')
            ret <- data.frame(t(unlist(ret)))
        return(ret)
    } else {
        ret <- data.frame()
        for (i in 1:length(ip))
        {
            r <- freegeoip(ip[i], format="dataframe")
            ret <- bind_rows(ret, r)
        }
        return(ret)
    }
}   

try.ip <- function(ip) {
  suppressWarnings(try(freegeoip(ip), silent = TRUE))
}

ips <- try.ip(data$IPAddress)
```

### LatLong

Get state, country information from Google API. Unfortunately, it's taking too long and Google has a limit for the number of API calls.

How to call the API via the browser:
https://maps.googleapis.com/maps/api/geocode/json?latlng=40.714224,-73.961452&key=AIzaSyC8Q7FY6SzmEfpMTOcx2BTrnYaRkzX12Ik

How to call the API via R:
```
library(revgeo)
revgeo(longitude=-73.961452, latitude=40.714224, output="frame", provider="google", API="AIzaSyC8Q7FY6SzmEfpMTOcx2BTrnYaRkzX12Ik")
```

This will always fail because of the limitation to the number of API calls:
```
ll <- revgeo(longitude = data$LocationLongitude, latitude = data$LocationLatitude, output = "frame", provider = "google", API = "AIzaSyC8Q7FY6SzmEfpMTOcx2BTrnYaRkzX12Ik")
```

Getting USA (or any other country)'s latlong

```
library(ggmap)
geocode("USA")
```
